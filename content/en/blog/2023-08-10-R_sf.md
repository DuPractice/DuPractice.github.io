---
title: Book Review: R as GIS for Economists
date: 2023-08-01T16:00:21-04:00
author: Xinting Du
slug: bookdown-tips
draft: false
toc: true
tags: R
---



## Chapter 2. Vector Data Handling with sf

sf 

do not need to create simple feature geometry from scratch. 


```r
# read shp file
eez <- read_sf('eez_v11.shp')

# writing to a shp file
st_write(eez, layer = 'eez2')

# alternative way to save shp file in R
saveRDS(eez, ''eez2.rds'')

# extract geometry column
st_geometry(eez[1, ])[[1]][[1]]
geometry <- st_geometry(eez)

# plot it
plot(st_geometry(eez[1, ]))

# register df as an sf object
st_as_sf()

# check the current CRS
st_crs(eez)

# transfer the CRS
eez2 <- st_transform(eez, st_crs(eez)) # keep two sf objects using the same CRS is important for interacting or mapping them.








# Step two in this approach is setting up the loop
for(i in 1:length(file.list)){
  
  temp<-import(file.list[i])
  
  if(i==1){amdts<-temp}
  	else{amdts<-bind_rows(amdts,temp)}
  
  print(paste("Loading file",i,"of",length(file.list),sep=" "))
}

```
One advantage is that the for loop could also be applied on importing data more than text data. However, when importing text data via this way, it is inefficient.



## Package readtext

This package could be really powerful if you have many individual files and did not combine them yet, or your data is in many formats and have many variables you want to keep them as covariates.

Here is the [manual reference](https://cran.r-project.org/web/packages/readtext/readtext.pdf).


```r
# ------ Data import ------ #
getwd()
data_dir <- 'you project directory/' 

files <- readtext(paste0(data_dir, "DocName/*"), # here, we import the raw files, drawing document metadata from the file names
# metadata, i.e. covariates
                             docvarsfrom = "filenames", 
                             dvsep="_", 
                             docvarnames = c("Name", "Session", "Year", "Actor", "Speech"))
                             
                             
# read .csv files
files <- readtext( paste0(data_dir, "DocName/*"), text_field = 'texts')                

# only read .txt files in a package
readtext(paste0(data_dir, "DocName/*.txt"))                          

```
The code will return a *data.frame* consisting of a columns doc_id and text that contain a document identifier and the texts respectively, with any additional columns consisting of document-level variables either found in the file containing the texts, or created through the readtext call.
Two advantages of using readtext. 

Once we have a data.frame, it is easy to transfer it into a *tibble*, which could be used in *tidyverse*, *tidytext*, and etc. 
Also, it could be transfered into corpus, which is used in *quanteda*.

```r
# into tibble

text_tibble <- text_files %>% 
	as_tibble()

# into corpus

text_corpus <- text_files %>%
	corprus()
```

